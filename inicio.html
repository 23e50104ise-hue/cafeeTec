<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CafeeTec ‚Äî Comunidad de Emprendedores</title>

  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#f7f5f2;
      --card:#ffffff;
      --accent:#6d4c41;
      --accent-2:#8d6e63;
      --muted:#7a7a7a;
      --glass: rgba(255,255,255,0.6);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:'Poppins',system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
      background:var(--bg);
      color:#222;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      line-height:1.4;
    }

    .hidden { display:none !important; }

    header{
      background:linear-gradient(135deg,var(--accent),var(--accent-2));
      color:#fff;
      padding:40px 20px;
      text-align:center;
      box-shadow:0 8px 30px rgba(0,0,0,0.12);
    }
    .brand{
      display:flex;align-items:center;gap:14px;justify-content:center;
    }
    .logo{
      width:56px;height:56px;border-radius:12px;background:rgba(255,255,255,0.12);display:flex;align-items:center;justify-content:center;font-weight:700;font-size:20px
    }
    header h1{margin:8px 0 4px;font-size:28px;letter-spacing:0.2px}
    header p{margin:0;opacity:0.95}

    nav{
      display:flex;gap:12px;justify-content:center;padding:14px 20px;background:transparent;position:sticky;top:0;z-index:30
    }
    .nav-btn{background:var(--card);border:0;padding:10px 18px;border-radius:999px;cursor:pointer;font-weight:600;box-shadow:0 4px 12px rgba(0,0,0,0.06);transition:transform .14s ease,box-shadow .14s}
    .nav-btn:hover{transform:translateY(-3px);box-shadow:0 8px 20px rgba(0,0,0,0.08)}

    .salir-btn{
      background:#d32f2f !important;
      color:#fff !important;
    }

    .container{max-width:1100px;margin:28px auto;padding:0 18px}
    .toolbar{display:flex;gap:12px;align-items:center;justify-content:space-between;flex-wrap:wrap;margin-bottom:18px}

    .search-wrap{display:flex;gap:8px;align-items:center}
    .search{padding:10px 14px;border-radius:12px;border:1px solid #e3ded9;background:var(--card);min-width:260px}
    .filter{padding:10px;border-radius:12px;border:1px solid #e9e3de;background:var(--card)}

    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:18px}
    .card{background:var(--card);padding:14px;border-radius:12px;box-shadow:0 8px 24px rgba(23,23,23,0.06);display:flex;flex-direction:column;overflow:hidden;transition:transform .18s ease,box-shadow .18s}
    .card:hover{transform:translateY(-8px);box-shadow:0 18px 40px rgba(20,20,20,0.08)}
    .thumb{height:160px;border-radius:10px;background:#f0edea;display:flex;align-items:center;justify-content:center;overflow:hidden}
    .thumb img{width:100%;height:100%;object-fit:cover}
    .meta{padding:10px 4px 0;flex:1;display:flex;flex-direction:column}
    .title{font-weight:700;font-size:16px;margin-bottom:6px}
    .desc{color:var(--muted);font-size:13px;margin-bottom:10px}
    .price{font-weight:700;color:var(--accent);margin-bottom:12px}
    .card-footer{display:flex;gap:8px;align-items:center}

    .btn{border:0;padding:10px 12px;border-radius:10px;cursor:pointer;font-weight:600}
    .btn-primary{background:var(--accent);color:#fff}
    .btn-secondary{background:#fff;border:1px solid #e6e0db}

    .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.45);display:none;align-items:center;justify-content:center;padding:20px;z-index:50}
    .modal{background:var(--card);max-width:720px;width:100%;border-radius:14px;padding:18px;box-shadow:0 10px 40px rgba(0,0,0,0.2)}
    .modal h3{margin:0 0 8px}
    .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    label{font-size:13px;color:#555}
    input,textarea,select{width:100%;padding:10px;border-radius:10px;border:1px solid #e3ded9;margin-top:6px;font-family:inherit}
    textarea{min-height:120px}

    .uploader{border:1px dashed #ddd;padding:12px;border-radius:10px;text-align:center;color:var(--muted);cursor:pointer}

    .empty{padding:40px;border-radius:12px;background:linear-gradient(180deg, #fff,#fbfaf8);text-align:center;border:1px dashed #eee}

    footer{padding:24px 18px;text-align:center;color:var(--muted);font-size:14px}

    @media (max-width:960px){.grid{grid-template-columns:repeat(2,1fr)}.thumb{height:140px}}
    @media (max-width:640px){.grid{grid-template-columns:1fr}.brand{flex-direction:column}.header-cta{margin-top:10px}.grid-2{grid-template-columns:1fr}.search{min-width:150px}}
  </style>
</head>
<body>

<header>
  <div class="brand">
    <div class="logo">C</div>
    <div>
      <h1>CafeeTec</h1>
      <p>Plataforma para emprendedores universitarios ‚Äî publica y vende dentro de la comunidad</p>
    </div>
  </div>
</header>

<nav id="navBar">
  <button class="nav-btn" id="btnInicio">Inicio</button>
  <button class="nav-btn" id="btnPublicar">Publicar producto</button>
  <button class="nav-btn" id="btnVer">Ver productos</button>

  <!-- üöÄ NUEVO BOT√ìN SALIR -->
  <button class="nav-btn salir-btn" id="btnSalir">Salir</button>
</nav>

<main class="container">
  <section class="toolbar">
    <div class="search-wrap">
      <input class="search" id="search" placeholder="Buscar productos...">
      <select id="filter" class="filter">
        <option value="all">Todas las categor√≠as</option>
        <option value="comida">Comida</option>
        <option value="bebida">Bebida</option>
        <option value="postre">Postre</option>
      </select>
    </div>
    <div>
      <button class="btn btn-primary" id="openPublicar">+ Publicar</button>
    </div>
  </section>
  <section id="productosArea"></section>
</main>

<footer>
  ¬© <span id="year"></span> CafeeTec ‚Ä¢ Comunidad estudiantil ¬∑ Hecho con ‚òï
</footer>

<!-- MODAL PUBLICAR -->
<div class="modal-backdrop" id="modalBackdrop">
  <div class="modal">
    <h3>Publicar nuevo producto</h3>
    <p style="margin-top:0;color:var(--muted);font-size:13px">Llena los datos y tu producto aparecer√° en el cat√°logo.</p>
    <div style="margin-top:12px">
      <div class="grid-2">
        <div>
          <label>Nombre</label>
          <input id="pNombre" placeholder="Nombre del producto">

          <label style="margin-top:10px">Precio (MXN)</label>
          <input id="pPrecio" placeholder="Ej. 45.00">

          <label style="margin-top:10px">Categor√≠a</label>
          <select id="pCategoria">
            <option value="comida">Comida</option>
            <option value="bebida">Bebida</option>
            <option value="postre">Postre</option>
          </select>
        </div>

        <div>
          <label>Imagen (arrastra o selecciona archivo)</label>
          <div class="uploader" id="uploader">Arrastra imagen o selecciona archivo<br>
            <small style="color:var(--muted)">Se almacenar√° localmente en tu navegador</small>
          </div>
          <input type="file" id="fileInput" accept="image/*" style="display:none">
          <input id="pImagen" placeholder="URL de la imagen (opcional)" style="margin-top:8px">
        </div>
      </div>

      <label style="margin-top:12px">Descripci√≥n</label>
      <textarea id="pDescripcion" placeholder="Describe tu producto de forma breve"></textarea>

      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
        <button class="btn btn-secondary" id="cancelModal">Cancelar</button>
        <button class="btn btn-primary" id="saveProduct">Publicar producto</button>
      </div>
    </div>
  </div>
</div>

<!-- MODAL DETALLE PRODUCTO -->
<div class="modal-backdrop" id="modalDetalle">
  <div class="modal" id="detalleContent">
    <h3 id="dNombre"></h3>
    <div class="thumb" id="dImagen" style="margin-top:8px;height:200px"></div>
    <p id="dDescripcion" style="margin-top:8px;color:var(--muted)"></p>
    <p id="dPrecio" style="font-weight:700;margin-top:8px"></p>
    <p id="dCategoria" style="font-size:13px;color:var(--muted)"></p>
    <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
      <button class="btn btn-secondary" onclick="cerrarDetalle()">Cerrar</button>
      <button class="btn btn-primary" id="dSolicitarBtn">Solicitar</button>
    </div>
  </div>
</div>

<!-- MODAL CONTACTO -->
<div class="modal-backdrop" id="modalContact">
  <div class="modal">
    <h3>Solicitar producto</h3>
    <p style="margin-top:0;color:var(--muted);font-size:13px">Escribe tu mensaje al vendedor.</p>
    <div style="margin-top:12px">
      <label>Tu nombre</label>
      <input id="cNombre" placeholder="Tu nombre">
      <label style="margin-top:10px">Tu correo</label>
      <input id="cEmail" placeholder="Tu correo">
      <label style="margin-top:10px">Mensaje</label>
      <textarea id="cMensaje" placeholder="Escribe aqu√≠ tu mensaje"></textarea>

      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
        <button class="btn btn-secondary" id="cancelContact">Cancelar</button>
        <button class="btn btn-primary" id="sendContact">Enviar mensaje</button>
      </div>
    </div>
  </div>
</div>

<script>
const LS_KEY = 'cafe_products_v2';
let productos = JSON.parse(localStorage.getItem(LS_KEY) || '[]');

const $ = id => document.getElementById(id);
const formatMoney = v => Number(v).toLocaleString('es-MX',{style:'currency',currency:'MXN'});
const productosArea = $('productosArea');
const modalBackdrop = $('modalBackdrop');
const uploader = $('uploader');

document.getElementById('year').textContent = new Date().getFullYear();

function escapeHtml(str){return String(str).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/\"/g,'&quot;').replace(/'/g,'&#039;');}
function truncate(text,n){return text.length>n?text.slice(0,n-1)+'‚Ä¶':text}

function renderProductos(filter='all',query=''){
  if(productos.length===0){productosArea.innerHTML=`<div class="empty"><h3>No hay productos publicados</h3></div>`;return;}
  const filtered = productos.filter(p=> (filter==='all'||p.categoria===filter) && (p.nombre.toLowerCase().includes(query.toLowerCase())||p.descripcion.toLowerCase().includes(query.toLowerCase())));
  if(filtered.length===0){productosArea.innerHTML=`<div class="empty"><h3>Sin resultados</h3></div>`;return;}

  const grid = document.createElement('div'); grid.className='grid';
  filtered.forEach((p,idx)=>{
    const card = document.createElement('article'); card.className='card';
    card.innerHTML=`
      <div class="thumb">${p.imagen?`<img src="${p.imagen}" alt="${escapeHtml(p.nombre)}">`:`<svg width=100 height=60 viewBox='0 0 100 60'><rect width='100' height='60' fill='#efeae6'/><text x='50' y='34' text-anchor='middle' fill='#c5bdb7' font-size='12'>Sin imagen</text></svg>`}</div>
      <div class="meta">
        <div class="title">${escapeHtml(p.nombre)}</div>
        <div class="desc">${escapeHtml(truncate(p.descripcion,120))}</div>
        <div class="price">${formatMoney(p.precio)}</div>
        <div class="card-footer">
          <button class="btn btn-secondary" onclick="verDetalle(${idx})">Ver</button>
          <button class="btn" onclick="solicitarProducto(${idx})">Solicitar</button>
          <button class="btn" style="margin-left:auto;color:#aa0000;background:transparent;border:1px solid #f2dad8" onclick="eliminar(${idx})">Eliminar</button>
        </div>
      </div>
    `;
    grid.appendChild(card);
  });
  productosArea.innerHTML=''; productosArea.appendChild(grid);
}

// ---------------- MODAL PUBLICAR ----------------
function abrirModal(){modalBackdrop.style.display='flex'; $('navBar').classList.add('hidden');}
function cerrarModal(){modalBackdrop.style.display='none'; limpiarFormulario(); $('navBar').classList.remove('hidden');}
function guardarProducto(){
  const nombre=$('pNombre').value.trim();
  const precio=parseFloat($('pPrecio').value.trim());
  const categoria=$('pCategoria').value;
  const descripcion=$('pDescripcion').value.trim();
  const imagen=$('pImagen').value.trim();
  if(!nombre||isNaN(precio)||!descripcion){alert('Completa nombre, precio y descripci√≥n.');return;}
  productos.unshift({nombre,precio,descripcion,categoria,imagen});
  localStorage.setItem(LS_KEY,JSON.stringify(productos));
  cerrarModal();
  renderProductos($('filter').value,$('search').value);
}
function limpiarFormulario(){ $('pNombre').value='';$('pPrecio').value='';$('pCategoria').value='comida';$('pDescripcion').value='';$('pImagen').value='';}

// ---------------- UPLOAD IMAGEN ----------------
uploader.addEventListener('click',()=>{$('fileInput').click();});
$('fileInput').addEventListener('change',e=>{
  const file=e.target.files[0];
  if(file && file.type.startsWith('image/')){const reader=new FileReader();reader.onload=()=>{$('pImagen').value=reader.result};reader.readAsDataURL(file);}
});
uploader.addEventListener('dragover',e=>{e.preventDefault();uploader.style.borderColor='var(--accent)';});
uploader.addEventListener('dragleave',e=>{e.preventDefault();uploader.style.borderColor='#ddd';});
uploader.addEventListener('drop',e=>{e.preventDefault();uploader.style.borderColor='#ddd';const file=e.dataTransfer.files[0];if(file&&file.type.startsWith('image/')){const reader=new FileReader();reader.onload=()=>{$('pImagen').value=reader.result};reader.readAsDataURL(file);}});

// ---------------- MODAL DETALLE ----------------
function verDetalle(idx){
  const p=productos[idx];
  $('dNombre').textContent=p.nombre;
  $('dDescripcion').textContent=p.descripcion;
  $('dPrecio').textContent=formatMoney(p.precio);
  $('dCategoria').textContent='Categor√≠a: '+p.categoria;
  $('dImagen').innerHTML=p.imagen?`<img src="${p.imagen}" style="width:100%;height:100%;object-fit:cover;">`:'<svg width=100 height=60 viewBox="0 0 100 60"><rect width="100" height="60" fill="#efeae6"/><text x="50" y="34" text-anchor="middle" fill="#c5bdb7" font-size="12">Sin imagen</text></svg>';
  $('modalDetalle').style.display='flex';
  $('navBar').classList.add('hidden');

  $('dSolicitarBtn').onclick=()=>{solicitarProducto(idx);cerrarDetalle();}
}
function cerrarDetalle(){ $('modalDetalle').style.display='none'; $('navBar').classList.remove('hidden'); }

// ---------------- MODAL CONTACTO ----------------
function solicitarProducto(idx){
  const p=productos[idx];
  $('modalContact').style.display='flex';
  $('navBar').classList.add('hidden');
  $('cMensaje').value=`Hola, estoy interesado en tu producto "${p.nombre}" con precio ${formatMoney(p.precio)}.`;
}
$('cancelContact').addEventListener('click',()=>{
  $('modalContact').style.display='none';
  $('navBar').classList.remove('hidden');
  $('cNombre').value='';$('cEmail').value='';$('cMensaje').value='';
});
$('sendContact').addEventListener('click',()=>{
  const nombre=$('cNombre').value.trim();
  const email=$('cEmail').value.trim();
  const mensaje=$('cMensaje').value.trim();
  if(!nombre||!email||!mensaje){alert('Completa todos los campos'); return;}
  const mailto=`mailto:${email}?subject=Solicitud de producto&body=${encodeURIComponent(mensaje)}`;
  window.open(mailto,'_blank');
  $('modalContact').style.display='none';
  $('navBar').classList.remove('hidden');
  $('cNombre').value='';$('cEmail').value='';$('cMensaje').value='';
});

// ---------------- ELIMINAR ----------------
function eliminar(idx){

  productos.splice(idx,1);
  localStorage.setItem(LS_KEY,JSON.stringify(productos));
  renderProductos($('filter').value,$('search').value);
}

// ---------------- BOT√ìN SALIR ----------------
$('btnSalir').addEventListener('click',()=>{
  window.location.href = "login.html"; // Cambia el nombre si tu archivo es diferente
});

// ---------------- EVENTOS ----------------
$('openPublicar').addEventListener('click',abrirModal);
$('btnPublicar').addEventListener('click',abrirModal);
$('cancelModal').addEventListener('click',cerrarModal);
$('saveProduct').addEventListener('click',guardarProducto);

$('btnInicio').addEventListener('click',()=>{$('search').value='';$('filter').value='all';renderProductos();window.scrollTo({top:0,behavior:'smooth'})});
$('btnVer').addEventListener('click',()=>renderProductos($('filter').value,$('search').value));
$('search').addEventListener('input',e=>renderProductos($('filter').value,e.target.value));
$('filter').addEventListener('change',e=>renderProductos(e.target.value,$('search').value));

// ---------------- INIT ----------------
(function init(){
  if(productos.length===0){
    productos=[
      {nombre:'Cappuccino Cl√°sico',precio:38.5,descripcion:'Espresso con leche espumada y un toque de cacao.',categoria:'bebida',imagen:''},
      {nombre:'Brownie de la casa',precio:28,descripcion:'Brownie casero con nuez y cobertura de chocolate.',categoria:'postre',imagen:''},
      {nombre:'Tostada francesa',precio:45,descripcion:'Tostada con miel, frutas frescas y crema.',categoria:'comida',imagen:''}
    ];
    localStorage.setItem(LS_KEY,JSON.stringify(productos));
  }
  renderProductos();
})();
</script>

</body>
</html>
